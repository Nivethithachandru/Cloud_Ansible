<!DOCTYPE html>

<html
  lang="en"
  class="light-style layout-navbar-fixed layout-menu-fixed"
  dir="ltr"
  data-theme="theme-default"
  data-assets-path="{{ url_for('static', path='/assets/') }}" 
  data-template="vertical-menu-template">
  <head>
    {% include 'header_file.html' %}

  </head>

  <body>

    <!-- Layout wrapper -->
    <div class="layout-wrapper layout-content-navbar">
      <div class="layout-container">
        <!--Sidenav Menu -->

        {% include 'side_nav.html' %}

        <!-- / Menu -->

        <!-- Layout container -->
        <div class="layout-page">
          <!-- Navbar -->

          {% include 'header_nav.html' %}


          <!-- / Navbar -->

          <!-- Content wrapper -->
          <div class="content-wrapper">


<!-- Content -->

<div class="container-xxl flex-grow-1 container-p-y">
<div class="row ">
<h4 class="py-3 breadcrumb-wrapper mb-4"> <span class="text-muted fw-light">{{ session.role_name }} /</span> Permission List </h4>


<form id="addRolepermissionForm" action="/main/roles/permission_modules/{{ role.id }}" method="POST" class="row g-3 card mt-5">
    <h5 class="card-header">Role Permissions List</h5>

    {% if alert_message %}
        <div class="alert alert-success alert-dismissible fade show" role="alert" id="alert-message">
            {% for message in alert_message %}
                {{ message }}<br>
            {% endfor %}
        </div>
    {% endif %}

    

    {% if modules is none or modules | length == 0 %}
                
    <div class="alert alert-default alert-dismissible fade show" >
        No data shown in the table        
    </div>

    {% else %}
                 
    <h6 class="py-3 breadcrumb-wrapper mb-2">
        <span class="text-muted fw-light">Role Name:</span> {{ role.role_name }}
    </h6>

    <div class="table-responsive ">
        
        <table class="table table-flush-spacing" id"permitted_table">
            <thead>
                <tr>
                    <th>Module Name</th>
                    <th>Show</th>
                    <th>Create</th>
                    <th>Read</th>
                    <th>Update</th>
                    <th>Delete</th>
                </tr>
            </thead>
            <tbody>
                {% for module in modules %}
                {% if module.id != 3 %}
                <tr>
                    <td class="text-nowrap">{{ module.module_name }}</td>
                    <td>
                        <div class="d-flex align-items-center">
                            <label class="switch switch-square switch-lg">
                                <span class="switch-label">Show</span>
                                <input type="checkbox" class="switch-input toggle-crud"
                                    name="{{ module.module_name|lower|replace(' ', '_')}}_show"
                                    {% if permissions_dict.get(module.id) and permissions_dict[module.id].show %} checked {% endif %}
                                    data-module-id="{{ module.id }}">
                                <span class="switch-toggle-slider">
                                    <span class="switch-on"><i class="bx bx-check"></i></span>
                                    <span class="switch-off"><i class="bx bx-x"></i></span>
                                </span>
                            </label>
                        </div>
                    </td>
                    {% if module.id != 6 and module.id != 7 %}
                    <td class="crud-checkboxes" id="crud-checkboxes-create-{{ module.id }}" style="display: none;">
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="checkbox"
                                name="{{ module.module_name|lower|replace(' ', '_')}}_create"
                                {% if permissions_dict.get(module.id) and permissions_dict[module.id].create %} checked {% endif %}>
                            <label class="form-check-label" for="create-{{ module.id }}">Create</label>
                        </div>
                    </td>
                    <td class="crud-checkboxes" id="crud-checkboxes-read-{{ module.id }}" style="display: none;">
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="checkbox"
                                name="{{ module.module_name|lower|replace(' ', '_')}}_read"
                                {% if permissions_dict.get(module.id) and permissions_dict[module.id].read %} checked {% endif %}>
                            <label class="form-check-label" for="read-{{ module.id }}">Read</label>
                        </div>
                    </td>
                    <td class="crud-checkboxes" id="crud-checkboxes-update-{{ module.id }}" style="display: none;">
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="checkbox"
                                name="{{ module.module_name|lower|replace(' ', '_')}}_update"
                                {% if permissions_dict.get(module.id) and permissions_dict[module.id].update %} checked {% endif %}>
                            <label class="form-check-label" for="update-{{ module.id }}">Update</label>
                        </div>
                    </td>
                    <td class="crud-checkboxes" id="crud-checkboxes-delete-{{ module.id }}" style="display: none;">
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="checkbox"
                                name="{{ module.module_name|lower|replace(' ', '_')}}_delete"
                                {% if permissions_dict.get(module.id) and permissions_dict[module.id].delete %} checked {% endif %}>
                            <label class="form-check-label" for="delete-{{ module.id }}">Delete</label>
                        </div>
                    </td>
                    {% endif %}
                </tr>
                {% endif %}
                {% endfor %}
            </tbody>
        </table>
        
    </div>
    <div class="mt-5 mb-5">
        <button type="submit" class="btn btn-primary me-sm-3 me-1">Submit</button>
    </div>
    {% endif %}

    
</form>




</div>
</div>
<!-- / Content -->

      
            <div class="content-backdrop fade mt-5"></div>
          </div>
        </div>
      </div>

      <div class="layout-overlay layout-menu-toggle"></div>

      <div class="drag-target"></div>
    </div>

    {% include 'script_file.html' %}
    
  </body>
  
</html>
<script>
    $(document).ready(function () {
  
        $(".crud-checkboxes").hide();
  
        $(".toggle-crud").each(function () {
            var moduleId = $(this).data("module-id");
            

            if (moduleId == 6 || moduleId == 7) return;
  
            var checkboxCreate = $("#crud-checkboxes-create-" + moduleId);
            var checkboxRead = $("#crud-checkboxes-read-" + moduleId);
            var checkboxUpdate = $("#crud-checkboxes-update-" + moduleId);
            var checkboxDelete = $("#crud-checkboxes-delete-" + moduleId);
  
            if ($(this).is(":checked")) {
                checkboxCreate.show();
                checkboxRead.show();
                checkboxUpdate.show();
                checkboxDelete.show();
            } else {
                checkboxCreate.hide();
                checkboxRead.hide();
                checkboxUpdate.hide();
                checkboxDelete.hide();
            }
        });
  
        $(".toggle-crud").on("change", function () {
            var moduleId = $(this).data("module-id");
  
            if (moduleId == 6 || moduleId == 7) return;
  
            var checkboxCreate = $("#crud-checkboxes-create-" + moduleId);
            var checkboxRead = $("#crud-checkboxes-read-" + moduleId);
            var checkboxUpdate = $("#crud-checkboxes-update-" + moduleId);
            var checkboxDelete = $("#crud-checkboxes-delete-" + moduleId);
  
            if ($(this).is(":checked")) {
                checkboxCreate.show();
                checkboxRead.show();
                checkboxUpdate.show();
                checkboxDelete.show();
            } else {
                checkboxCreate.hide();
                checkboxRead.hide();
                checkboxUpdate.hide();
                checkboxDelete.hide();
            }
        });
    });

    setTimeout(function() {
        var alertElement = document.getElementById('alert-message');
        if (alertElement) {
            alertElement.classList.remove('show');
        }
    }, 5000);
    
</script>
